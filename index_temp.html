<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether 7.1 | Natural Rain</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --accent: #00e5ff;
            --accent-glow: rgba(0, 229, 255, 0.4);
            --glass-surface: rgba(18, 18, 24, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.5);
        }

        /* –¢–µ–º—ã */
        body.mode-rain { --accent: #a855f7; --accent-glow: rgba(168, 85, 247, 0.4); }
        body.mode-ember { --accent: #f59e0b; --accent-glow: rgba(245, 158, 11, 0.4); }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter Tight', sans-serif; }

        body {
            height: 100vh;
            background: #050505;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            user-select: none;
            transition: --accent 1s;
        }

        /* --- –§–û–ù --- */
        .deep-bg { position: absolute; inset: 0; z-index: -2; background: radial-gradient(circle at 50% -20%, #1a1a2e, #000000); transition: background 0.4s ease; }
        body.mode-ember .deep-bg { background: radial-gradient(circle at 50% -20%, #2a1505, #000000); }
        body.mode-rain .deep-bg { background: radial-gradient(circle at 50% -20%, #180d26, #000000); }

        .ambient-glow {
            position: absolute; width: 600px; height: 600px; background: var(--accent);
            filter: blur(180px); opacity: 0.15; border-radius: 50%;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            animation: breathe 10s infinite alternate ease-in-out; z-index: -2;
            transition: background 0.4s ease;
        }
        @keyframes breathe { 0% { opacity: 0.1; transform: translate(-50%, -50%) scale(0.8); } 100% { opacity: 0.2; transform: translate(-50%, -50%) scale(1.2); } }

        /* --- –ß–ê–°–¢–ò–¶–´ (–ù–û–í–ê–Ø –§–ò–ó–ò–ö–ê) --- */
        .particle-layer {
            position: absolute; inset: 0; pointer-events: none; z-index: -1; overflow: hidden;
            transition: opacity 0.3s ease-in-out;
        }
        .particle-layer.fading { opacity: 0; }

        /* 1. –°–Ω–µ–≥ */
        .flake {
            position: absolute; background: white; border-radius: 50%;
            animation: fall linear infinite;
        }
        @keyframes fall {
            from { transform: translateY(-10vh) translateX(-10px); }
            to { transform: translateY(110vh) translateX(10px); }
        }

        /* 2. –î–æ–∂–¥—å (–ö—Ä–∞—Å–∏–≤—ã–π) */
        .rain-drop {
            position: absolute;
            width: 1px;
            background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.8)); /* –ì—Ä–∞–¥–∏–µ–Ω—Ç —Ö–≤–æ—Å—Ç–∞ */
            opacity: 0.7;
            transform: rotate(15deg); /* –ù–∞–∫–ª–æ–Ω –¥–æ–∂–¥—è */
            animation: rainFall linear infinite;
        }
        @keyframes rainFall {
            from { transform: translateY(-20vh) translateX(0) rotate(15deg); }
            to { transform: translateY(120vh) translateX(-20px) rotate(15deg); }
        }

        /* 3. –£–≥–ª–∏ */
        .ember-spark {
            position: absolute; background: #ffaa00; border-radius: 50%;
            box-shadow: 0 0 5px #ff7b00;
            animation: rise linear infinite;
        }
        @keyframes rise {
            from { transform: translateY(110vh) translateX(0); opacity: 0; }
            50% { opacity: 1; }
            to { transform: translateY(-10vh) translateX(-20px); opacity: 0; }
        }

        /* --- UI --- */
        .app-container {
            display: grid; grid-template-columns: 380px 0px; gap: 0px;
            transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); position: relative;
        }
        .app-container.playlist-open { grid-template-columns: 380px 300px; gap: 20px; }

        .player-card {
            width: 380px; background: var(--glass-surface);
            backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-radius: 40px; border: 1px solid var(--glass-border);
            padding: 40px 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8), inset 0 1px 1px rgba(255,255,255,0.15);
            display: flex; flex-direction: column; align-items: center;
            z-index: 10; position: relative;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–æ–≥–æ–¥—ã */
        .mood-btn {
            position: absolute; top: 25px; right: 25px;
            width: 35px; height: 35px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-dim); cursor: pointer; transition: 0.3s;
            background: rgba(255,255,255,0.05);
        }
        .mood-btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 15px var(--accent); }

        /* –ü–ª–µ–π–ª–∏—Å—Ç */
        .playlist-panel {
            background: var(--glass-surface); backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border); border-radius: 30px; padding: 20px;
            overflow: hidden; opacity: 0; pointer-events: none;
            transform: translateX(-30px); transition: 0.4s ease;
            display: flex; flex-direction: column; height: 100%;
        }
        .app-container.playlist-open .playlist-panel { opacity: 1; pointer-events: all; transform: translateX(0); }

        /* –í–∏–∑—É–∞–ª */
        .visual-container { width: 260px; height: 260px; margin-bottom: 40px; display: flex; align-items: center; justify-content: center; position: relative; }
        .pulse-aura {
            position: absolute; inset: 10px; border-radius: 50%; background: var(--accent);
            filter: blur(40px); opacity: 0; transition: 0.8s; z-index: 0;
        }
        .album-art-wrapper {
            width: 100%; height: 100%; border-radius: 50%; position: relative; z-index: 2;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            padding: 3px;
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
        }
        .album-art {
            width: 100%; height: 100%; border-radius: 50%; object-fit: cover;
            animation: rotateVinyl 30s linear infinite; opacity: 0.9;
            transition: opacity 0.4s ease-in-out, transform 0.4s;
            filter: saturate(0.6) brightness(0.85) contrast(1.05);
            position: relative;
            z-index: 3;
        }
        .fade-transition { opacity: 0 !important; transform: scale(0.95); }
        .playing .album-art { animation-duration: 5s; }
        @keyframes rotateVinyl { 100% { transform: rotate(360deg); } }

        /* –ò–Ω—Ñ–æ */
        .info-area { text-align: center; width: 100%; margin-bottom: 30px; z-index: 2; }
        .track-name, .artist-name { transition: opacity 0.4s ease, color 0.4s ease; }
        .track-name { font-size: 1.6rem; font-weight: 700; color: var(--text-main); margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .artist-name { font-size: 0.9rem; color: var(--accent); font-weight: 500; letter-spacing: 1.5px; text-transform: uppercase; }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å */
        .progress-area { width: 100%; margin-bottom: 35px; }
        .slider-container { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; position: relative; cursor: pointer; overflow: hidden; transition: height 0.2s; }
        .slider-container:hover { height: 8px; }
        .slider-fill { height: 100%; width: 0%; background: var(--accent); box-shadow: 0 0 15px var(--accent-glow); border-radius: 10px; transition: width 0.1s linear, background 0.3s ease, box-shadow 0.3s ease; }
        .timers { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-dim); margin-top: 8px; font-weight: 500; }

        /* –ö–æ–Ω—Ç—Ä–æ–ª—ã */
        .controls { display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 0 10px; }
        .main-ctrls { display: flex; align-items: center; gap: 25px; }
        .ctrl-btn { background: none; border: none; color: var(--text-dim); font-size: 1.5rem; cursor: pointer; transition: 0.2s; }
        .ctrl-btn:hover { color: white; transform: scale(1.1); }
        .play-btn-circle {
            width: 75px; height: 75px; border-radius: 50%; background: var(--text-main); color: black;
            display: flex; align-items: center; justify-content: center; font-size: 1.8rem;
            box-shadow: 0 0 20px rgba(255,255,255,0.1); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), background 1s; cursor: pointer;
        }
        .play-btn-circle:hover { transform: scale(1.1); box-shadow: 0 0 40px var(--accent-glow); background: var(--accent); }

        /* –°–ø–∏—Å–æ–∫ */
        .playlist-header { font-size: 0.8rem; text-transform: uppercase; color: #666; margin-bottom: 10px; font-weight: 700; letter-spacing: 1px; }
        .playlist-scroll { flex: 1; overflow-y: auto; padding-right: 5px; }
        .playlist-scroll::-webkit-scrollbar { width: 3px; }
        .playlist-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        .track-item { display: flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 10px; cursor: pointer; transition: 0.2s, border-color 0.3s ease; margin-bottom: 5px; position: relative; }
        .track-item:hover { background: rgba(255,255,255,0.05); }
        .track-item:hover .track-delete-btn { opacity: 1; }
        .track-item.active { background: rgba(255, 255, 255, 0.1); border: 1px solid var(--accent); }
        .track-delete-btn {
            background: none; border: none; color: rgba(255,255,255,0.3);
            cursor: pointer; font-size: 0.9rem; padding: 0;
            width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;
            border-radius: 4px; opacity: 0; transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .track-delete-btn:hover { background: rgba(255,0,0,0.2); color: #ff4444; }
        .t-name-mini { font-size: 0.85rem; color: #ccc; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; transition: color 0.3s ease; }
        .track-item.active .t-name-mini { color: var(--accent); }

        .drag-msg { position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50; opacity: 0; pointer-events: none; transition: 0.3s; border-radius: 40px; }
        .drag-active .drag-msg { opacity: 1; pointer-events: all; }
        .drag-msg h2 { color: var(--accent); font-size: 2rem; transition: color 0.3s ease; }

        input[type="file"] { display: none; }

        /* Search Modal - –£–õ–£–ß–®–ï–ù–ù–´–ô */
        .search-modal {
            position: fixed; inset: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(10,10,20,0.95));
            backdrop-filter: blur(20px); z-index: 100;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.4s ease, backdrop-filter 0.4s ease;
        }
        .search-modal.active { opacity: 1; pointer-events: all; }

        .search-modal-content {
            background: linear-gradient(145deg, rgba(25, 25, 35, 0.95), rgba(15, 15, 20, 0.95));
            backdrop-filter: blur(50px) saturate(180%);
            border: 1.5px solid rgba(255, 255, 255, 0.15);
            border-radius: 28px;
            padding: 35px; width: 90%; max-width: 650px; max-height: 85vh;
            box-shadow: 0 30px 90px rgba(0,0,0,0.95),
                        0 0 0 1px rgba(255,255,255,0.05),
                        inset 0 1px 2px rgba(255,255,255,0.1);
            display: flex; flex-direction: column;
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .search-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 28px; padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .search-header h3 {
            color: var(--text-main); font-size: 1.75rem; margin: 0;
            font-weight: 700;
            display: flex; align-items: center; gap: 12px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .search-header h3::before {
            content: 'üéµ';
            font-size: 1.5rem;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .close-modal {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-dim);
            font-size: 1.3rem; cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }
        .close-modal:hover {
            background: rgba(255,50,50,0.3);
            color: white;
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 5px 20px rgba(255,50,50,0.3);
        }

        .search-input-container {
            display: flex; gap: 12px; margin-bottom: 25px;
            position: relative;
        }

        #searchInput, #urlInput {
            flex: 1;
            background: rgba(255,255,255,0.08);
            border: 1.5px solid rgba(255,255,255,0.12);
            border-radius: 14px;
            padding: 15px 20px 15px 48px;
            color: white; font-size: 0.95rem;
            outline: none;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }
        #searchInput::placeholder, #urlInput::placeholder {
            color: rgba(255,255,255,0.3);
        }
        #searchInput:focus, #urlInput:focus {
            border-color: var(--accent);
            background: rgba(255,255,255,0.12);
            box-shadow: 0 0 0 3px var(--accent-glow),
                        inset 0 2px 5px rgba(0,0,0,0.2);
            transform: translateY(-1px);
        }

        /* –ò–∫–æ–Ω–∫–∏ –≤ –∏–Ω–ø—É—Ç–∞—Ö */
        .search-input-container:first-of-type #searchInput {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300e5ff'%3E%3Cpath d='M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 16px center;
            background-size: 20px;
        }
        .url-input-section #urlInput {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300e5ff'%3E%3Cpath d='M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 16px center;
            background-size: 20px;
        }

        .search-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent));
            border: none; border-radius: 14px;
            padding: 15px 28px; color: black; font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-weight: 700;
            box-shadow: 0 6px 25px var(--accent-glow),
                        inset 0 1px 1px rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }
        .search-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .search-btn:hover::before {
            left: 100%;
        }
        .search-btn:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 10px 35px var(--accent-glow),
                        inset 0 1px 1px rgba(255,255,255,0.5);
        }
        .search-btn:active {
            transform: scale(1.02);
        }

        .search-results {
            flex: 1; overflow-y: auto; padding-right: 8px;
            margin-top: 10px;
        }
        .search-results::-webkit-scrollbar { width: 6px; }
        .search-results::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        .search-results::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            transition: background 0.3s;
        }
        .search-results::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }

        .search-placeholder {
            text-align: center; color: var(--text-dim);
            padding: 60px 30px;
            font-size: 1rem; font-weight: 500;
            display: flex; flex-direction: column; align-items: center; gap: 15px;
        }
        .search-placeholder::before {
            content: 'üéº';
            font-size: 3rem;
            opacity: 0.5;
        }

        .search-item {
            display: flex; align-items: center; gap: 14px;
            padding: 14px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px;
            margin-bottom: 12px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
        }
        .search-item:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.15);
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3),
                        0 0 20px var(--accent-glow);
        }

        .search-item-thumb {
            width: 70px; height: 70px; border-radius: 12px;
            object-fit: cover; background: #1a1a1a;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .search-item-info {
            flex: 1; min-width: 0;
        }
        .search-item-title {
            color: white; font-size: 0.95rem; font-weight: 600;
            margin-bottom: 6px; white-space: nowrap; overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .search-item-channel {
            color: var(--text-dim); font-size: 0.8rem; font-weight: 500;
            display: flex; align-items: center; gap: 5px;
        }
        .search-item-channel::before {
            content: 'üë§';
            font-size: 0.7rem;
        }

        .add-track-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent));
            border: none; border-radius: 12px;
            padding: 10px 20px; color: black; font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-weight: 700;
            white-space: nowrap;
            box-shadow: 0 4px 15px var(--accent-glow);
        }
        .add-track-btn:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 6px 20px var(--accent-glow);
        }
        .add-track-btn:disabled {
            opacity: 0.5; cursor: not-allowed;
            transform: none;
        }

        .url-input-section {
            margin-top: 25px; padding-top: 25px;
            border-top: 1.5px solid rgba(255,255,255,0.12);
        }
        .url-label {
            color: var(--accent);
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .url-label::before, .url-label::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }

        /* –¢–ê–ë–´ –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –ü–õ–ê–¢–§–û–†–ú */
        .platform-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            background: rgba(255,255,255,0.05);
            padding: 6px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .platform-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--text-dim);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .platform-tab:hover {
            background: rgba(255,255,255,0.08);
            color: white;
        }
        .platform-tab.active {
            background: var(--accent);
            color: black;
            box-shadow: 0 4px 15px var(--accent-glow);
        }
        .platform-tab i {
            font-size: 1.1rem;
        }

    </style>
</head>
<body>

    <div class="deep-bg"></div>
    <div class="ambient-glow"></div>
    <div class="particle-layer" id="particles"></div>

    <input type="file" id="file-input" multiple accept="audio/*">

    <div class="app-container" id="appContainer">

        <div class="player-card" id="card">
            <div class="mood-btn" onclick="changeAtmosphere()" title="–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞">
                <i class="fas fa-snowflake" id="moodIcon"></i>
            </div>

            <div class="drag-msg">
                <i class="fas fa-compact-disc fa-spin" style="font-size: 4rem; margin-bottom: 20px; color: var(--accent);"></i>
                <h2>Drop Files Here</h2>
            </div>

            <div class="visual-container">
                <div class="pulse-aura" id="aura"></div>
                <div class="album-art-wrapper">
                    <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=600&auto=format&fit=crop" class="album-art" id="art">
                </div>
            </div>

            <div class="info-area">
                <div class="track-name" id="title">Aether System</div>
                <div class="artist-name" id="artist">System Online</div>
            </div>

            <div class="progress-area">
                <div class="slider-container" id="seek-bar">
                    <div class="slider-fill" id="fill"></div>
                </div>
                <div class="timers">
                    <span id="curr">0:00</span>
                    <span id="dur">0:00</span>
                </div>
            </div>

            <div class="controls">
                <button class="ctrl-btn" onclick="togglePlaylist()" title="–û—á–µ—Ä–µ–¥—å"><i class="fas fa-list"></i></button>
                <div class="main-ctrls">
                    <button class="ctrl-btn" onclick="prevTrack()"><i class="fas fa-backward"></i></button>
                    <div class="play-btn-circle" id="playBtn" onclick="togglePlay()">
                        <i class="fas fa-play" style="margin-left: 4px;"></i>
                    </div>
                    <button class="ctrl-btn" onclick="nextTrack()"><i class="fas fa-forward"></i></button>
                </div>
                 <button class="ctrl-btn" onclick="document.getElementById('file-input').click()" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã"><i class="fas fa-folder-open"></i></button>
            </div>
        </div>

        <div class="playlist-panel">
            <div class="playlist-header">–û—á–µ—Ä–µ–¥—å (<span id="count">0</span>)</div>
            <div class="playlist-scroll" id="playlistBox"></div>
        </div>
    </div>

    <audio id="audio" crossorigin="anonymous"></audio>

    <script>
        // --- –ß–ê–°–¢–ò–¶–´ (–ù–ê–¢–£–†–ê–õ–¨–ù–´–ï) ---
        const particleBox = document.getElementById('particles');
        const moodIcon = document.getElementById('moodIcon');
        let currentMode = 0;

        function initParticles(mode) {
            particleBox.innerHTML = '';

            // 0: –°–ù–ï–ì
            if(mode === 0) {
                document.body.className = '';
                moodIcon.className = 'fas fa-snowflake';
                for(let i=0; i<40; i++) {
                    let f = document.createElement('div'); f.className = 'flake';
                    let s = Math.random()*3+2; f.style.width=s+'px'; f.style.height=s+'px';
                    f.style.left=Math.random()*100+'%';
                    f.style.animationDuration=(Math.random()*10+10)+'s';
                    // –û–¢–†–ò–¶–ê–¢–ï–õ–¨–ù–ê–Ø –∑–∞–¥–µ—Ä–∂–∫–∞ = –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø–æ –≤—Å–µ–π –≤—ã—Å–æ—Ç–µ
                    f.style.animationDelay = '-' + (Math.random()*20)+'s';
                    f.style.filter=`blur(${Math.random()}px)`;
                    f.style.opacity=Math.random()*0.5+0.1;
                    particleBox.appendChild(f);
                }
            }
            // 1: –î–û–ñ–î–¨ (–ü–†–ò–Ø–¢–ù–´–ô)
            else if(mode === 1) {
                document.body.className = 'mode-rain';
                moodIcon.className = 'fas fa-cloud-showers-heavy';
                for(let i=0; i<80; i++) { // –ë–æ–ª—å—à–µ –∫–∞–ø–µ–ª—å
                    let d = document.createElement('div'); d.className = 'rain-drop';
                    d.style.left=Math.random()*100+'%';
                    d.style.height = (Math.random()*20 + 10) + 'px'; // –†–∞–∑–Ω–∞—è –¥–ª–∏–Ω–∞
                    d.style.animationDuration=(Math.random()*0.5+0.4)+'s'; // –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ
                    // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
                    d.style.animationDelay = '-' + Math.random()+'s';
                    particleBox.appendChild(d);
                }
            }
            // 2: –£–ì–õ–ò
            else if(mode === 2) {
                document.body.className = 'mode-ember';
                moodIcon.className = 'fas fa-fire';
                for(let i=0; i<30; i++) {
                    let e = document.createElement('div'); e.className = 'ember-spark';
                    let s = Math.random()*4+2; e.style.width=s+'px'; e.style.height=s+'px';
                    e.style.left=Math.random()*100+'%';
                    e.style.animationDuration=(Math.random()*5+4)+'s';
                    e.style.animationDelay = '-' + (Math.random()*10)+'s';
                    e.style.opacity=Math.random()*0.6+0.2;
                    particleBox.appendChild(e);
                }
            }
        }

        initParticles(0);

        function changeAtmosphere() {
            currentMode++;
            if(currentMode > 2) currentMode = 0;

            // –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —á–∞—Å—Ç–∏—Ü
            particleBox.classList.add('fading');

            // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è fade out –∞–Ω–∏–º–∞—Ü–∏–∏, –∑–∞—Ç–µ–º –º–µ–Ω—è–µ–º —á–∞—Å—Ç–∏—Ü—ã
            setTimeout(() => {
                initParticles(currentMode);
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å fading –¥–ª—è fade in —ç—Ñ—Ñ–µ–∫—Ç–∞
                particleBox.classList.remove('fading');
            }, 300);
        }

        // --- –õ–û–ì–ò–ö–ê ---
        const audio = document.getElementById('audio');
        const fileInput = document.getElementById('file-input');
        const appContainer = document.getElementById('appContainer');
        const playlistBox = document.getElementById('playlistBox');

        const art = document.getElementById('art');
        const titleEl = document.getElementById('title');
        const artistEl = document.getElementById('artist');
        const playBtn = document.getElementById('playBtn');
        const fill = document.getElementById('fill');
        const aura = document.getElementById('aura');

        let playlist = [];
        let currentIdx = 0;
        let isPlaying = false;
        let audioCtx, analyser, dataArray;
        let setupDone = false;
        let animationId;

        window.addEventListener('dragover', e => { e.preventDefault(); document.querySelector('.drag-msg').parentNode.parentNode.classList.add('drag-active'); document.querySelector('.drag-msg').style.opacity = '1'; });
        window.addEventListener('dragleave', e => { if(!e.relatedTarget || !appContainer.contains(e.relatedTarget)) { document.querySelector('.drag-msg').style.opacity = '0'; }});
        window.addEventListener('drop', e => {
            e.preventDefault(); document.querySelector('.drag-msg').style.opacity = '0';
            if(e.dataTransfer.files.length) handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', e => handleFiles(e.target.files));

        function handleFiles(files) {
            let newTracks = Array.from(files).filter(f => f.type.startsWith('audio'));
            if(newTracks.length === 0) return;
            newTracks.forEach(file => {
                playlist.push({
                    name: file.name.replace(/\.[^/.]+$/, ""),
                    src: URL.createObjectURL(file),
                    id: Math.random().toString(36).substr(2, 9)
                });
            });
            renderPlaylist();
            if(playlist.length === newTracks.length) loadTrack(0);
            if(playlist.length > 1) appContainer.classList.add('playlist-open');
        }

        function renderPlaylist() {
            playlistBox.innerHTML = '';
            document.getElementById('count').innerText = playlist.length;
            playlist.forEach((track, idx) => {
                let div = document.createElement('div');
                div.className = `track-item ${idx === currentIdx ? 'active' : ''}`;
                div.innerHTML = `
                    <button class="track-delete-btn" onclick="event.stopPropagation(); removeTrack(${idx})">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="t-name-mini">${track.name}</div>
                `;
                div.onclick = () => loadTrack(idx);
                playlistBox.appendChild(div);
            });
        }

        function removeTrack(idx) {
            // –£–¥–∞–ª—è–µ–º —Ç—Ä–µ–∫ –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞
            playlist.splice(idx, 1);

            // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ —Ç–µ–∫—É—â–∏–π —Ç—Ä–µ–∫
            if (idx === currentIdx) {
                if (playlist.length === 0) {
                    // –ü–ª–µ–π–ª–∏—Å—Ç –ø—É—Å—Ç
                    audio.pause();
                    audio.src = '';
                    isPlaying = false;
                    titleEl.innerText = 'Aether System';
                    artistEl.innerText = 'System Online';
                    art.src = 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=600&auto=format&fit=crop';
                    playBtn.innerHTML = '<i class="fas fa-play" style="margin-left: 4px;"></i>';
                    currentIdx = 0;
                } else {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫ –∏–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π
                    if (currentIdx >= playlist.length) currentIdx = 0;
                    loadTrack(currentIdx);
                }
            } else if (idx < currentIdx) {
                // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ —Ç—Ä–µ–∫ –¥–æ —Ç–µ–∫—É—â–µ–≥–æ, —Å–¥–≤–∏–≥–∞–µ–º –∏–Ω–¥–µ–∫—Å
                currentIdx--;
            }

            renderPlaylist();
        }

        function loadTrack(idx) {
            art.classList.add('fade-transition');
            titleEl.style.opacity = '0';
            artistEl.style.opacity = '0';

            setTimeout(() => {
                currentIdx = idx;
                audio.src = playlist[idx].src;
                titleEl.innerText = playlist[idx].name;
                artistEl.innerText = "Local Audio";
                art.src = `https://source.unsplash.com/random/600x600/?space,neon,blue,${playlist[idx].id}`;

                art.onload = () => { art.classList.remove('fade-transition'); };
                setTimeout(() => art.classList.remove('fade-transition'), 200);

                titleEl.style.opacity = '1';
                artistEl.style.opacity = '1';
                renderPlaylist();
                playAudio();
            }, 400);
        }

        function togglePlay() {
            if(!playlist.length) return fileInput.click();
            isPlaying ? pauseAudio() : playAudio();
        }

        function playAudio() {
            if(!setupDone) setupViz();
            audio.play();
            isPlaying = true;
            document.body.classList.add('playing');
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            vizLoop();
        }

        function pauseAudio() {
            audio.pause();
            isPlaying = false;
            document.body.classList.remove('playing');
            playBtn.innerHTML = '<i class="fas fa-play" style="margin-left: 4px;"></i>';
            cancelAnimationFrame(animationId);
            aura.style.opacity = 0;
            aura.style.transform = 'scale(1)';
        }

        function nextTrack() {
            let next = currentIdx + 1;
            if(next >= playlist.length) next = 0;
            loadTrack(next);
        }

        function prevTrack() {
            let prev = currentIdx - 1;
            if(prev < 0) prev = playlist.length - 1;
            loadTrack(prev);
        }

        function togglePlaylist() {
            appContainer.classList.toggle('playlist-open');
        }

        audio.addEventListener('ended', nextTrack);

        function setupViz() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            let source = audioCtx.createMediaElementSource(audio);
            source.connect(analyser);
            analyser.connect(audioCtx.destination);
            analyser.fftSize = 64;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            setupDone = true;
        }

        function vizLoop() {
            if(!isPlaying) return;
            animationId = requestAnimationFrame(vizLoop);
            analyser.getByteFrequencyData(dataArray);
            let bass = 0; for(let i=0; i<5; i++) bass += dataArray[i];
            bass = bass / 5;
            let scale = 1 + (bass / 255) * 0.5;
            let opacity = (bass / 255) * 0.8;
            aura.style.transform = `scale(${scale})`;
            aura.style.opacity = opacity;
            playBtn.style.boxShadow = `0 0 ${20 + bass/3}px var(--accent-glow)`;
        }

        audio.addEventListener('timeupdate', () => {
            const pct = (audio.currentTime / audio.duration) * 100;
            fill.style.width = pct + '%';
            document.getElementById('curr').innerText = fmt(audio.currentTime);
            document.getElementById('dur').innerText = fmt(audio.duration || 0);
        });

        document.getElementById('seek-bar').addEventListener('click', (e) => {
            const w = document.getElementById('seek-bar').clientWidth;
            audio.currentTime = (e.offsetX / w) * audio.duration;
        });

        function fmt(s) {
            let m=Math.floor(s/60), sec=Math.floor(s%60);
            return `${m}:${sec<10?'0'+sec:sec}`;
        }
    </script>
</body>
</html>
